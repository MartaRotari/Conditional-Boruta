---
title: "Example: Conditional Boruta"
output: html_notebook
---


<style type="text/css">

body{ /* Normal  */
      font-size: 12px;
  }
td {  /* Table  */
  font-size: 8px;
}
h1.title {
  font-size: 38px;
  color: DarkRed;
}
h1 { /* Header 1 */
  font-size: 28px;
  color: DarkBlue;
}
</style>

In this notebook is presented a simple example to show how to run the Conditional Boruta.\

The data used in this case are simulated data, to ensure the effectiveness of the model. 
The matrix for the input variables $X$ is composed of $20$ variables drawn from a joint normal distribution with mean 0 and variance 1.
\( X \sim N_{20}(0, \Sigma ), \ \ \ \ \epsilon \sim N(0, 0.1) \) \
One group on correlated variables are introduced \( [X_1, X_2, X_3, X_4, X_5] \), in this case the correlation is set to $0.7$.
```{r}
# Simulate the data
n_data <- 200

# correlation matrix
correlation_matrix <- matrix(0,20,20)
correlation_matrix[1:5,1:5] <- 0.7
diag(correlation_matrix)<-1
# multivariate normal distribution
data = data.frame( mvrnorm( n = n_data, mu = rep(0,20), Sigma = correlation_matrix ) )
corrplot( cor(data) )
# noise
noise = rnorm( n_data , mean = 0, sd = sqrt(0.1) )

```
The response variable is generated as a linear combination of $X'$ where $X'= [X_2, X _7]$ and the coeï¬ƒcients $\beta_i$ for $i \in{2, 7}$ are such that $\beta_i /sd(\beta_i) > 2$, where $sd(\cdot)$ is the standard deviation. The model for $Y$ is given as

\( y_1 = \beta_1 X_1 + \beta_2 X_{7}+ \epsilon  \) \

```{r}
X = cbind( data$X2, data$X7)
var_beta = var_noise * solve( t(X)%*%X )
sd_beta = sqrt( diag(var_beta) )
ratio = 3
beta = sd_beta*ratio
data$y = beta[1]*data$X2 + beta[2]*data$X7 + noise
```



## The Conditional Boruta

```{r}
source("boruta_conditional.R")
cb <- Condition_Boruta(y~., data = data, doTrace = 1, getImp=getImpRfCond)

```


```{r}
print(cb)
```

```{r}
plotImpHistory(cb)
```

```{r}
## Dataframe of result
boruta.df <- attStats(cb)
print(boruta.df)
```


```{r}
plot.Boruta(cb)   
```

### To fix the Tentative variables

```{r}
final.boruta <- TentativeRoughFix(cb)
print(final.boruta)
```


```{r}
plot.Boruta(final.boruta)
```


## The Original Boruta algorithm 

```{r}
library(Boruta)
b_model = Boruta(y~., data = data, doTrace = 1)
```

```{r}
print(b_model)
```


```{r}
mod.boruta <- TentativeRoughFix(b_model)
print(mod.boruta)
```


```{r}
plot(mod.boruta, xlab = "", xaxt = "n")
lz<-lapply(1:ncol(mod.boruta$ImpHistory),function(i)
mod.boruta$ImpHistory[is.finite(mod.boruta$ImpHistory[,i]),i])
names(lz) <- colnames(mod.boruta$ImpHistory)
Labels <- sort(sapply(lz,median))
axis(side = 1,las=2,labels = names(Labels),
at = 1:ncol(mod.boruta$ImpHistory), cex.axis = 0.7)
```





